<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Osyam VP - Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</title>
<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#0b0c10,#1a1a1a);
  color:#fff;
}
.container{
  max-width:700px;
  margin:20px auto;
  padding:10px;
}
h2{
  text-align:center;
  color:#00ff00;
  margin-bottom:10px;
  text-shadow:0 0 8px #00ff00;
}
.level-box{
  text-align:center;
  margin-bottom:25px;
  font-size:18px;
  color:#ffd700;
}
.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(15px);
  border-radius:20px;
  padding:20px;
  margin-bottom:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 5px 15px rgba(0,0,0,0.6);
  transition:0.3s;
}
.card:hover{
  transform:scale(1.02);
  box-shadow:0 10px 25px rgba(0,0,0,0.8);
}
.card.locked{
  opacity:0.5;
}
.card h3{
  margin:0;
  font-size:20px;
  color:#ffd700;
  text-shadow:0 0 5px #ffd700;
}
.card p{
  margin:4px 0;
  font-size:16px;
}
button{
  padding:10px 18px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,#1a1a1a,#333);
  color:#00ff00;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}
button:hover:not(:disabled){
  background:linear-gradient(135deg,#333,#555);
  transform:scale(1.05);
}
button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ’¹ Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± VP</h2>
  <div class="level-box" id="levelBox">â­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: VIP 0</div>
  <div id="plans"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBiQ4dHe4sbKDIrsyF8WdpjV3sY4qAxU4E",
  authDomain: "osim-d1821.firebaseapp.com",
  projectId: "osim-d1821",
  storageBucket: "osim-d1821.firebasestorage.app",
  messagingSenderId: "464951343183",
  appId: "1:464951343183:web:21c7615a90e4f38385923a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const plansContainer = document.getElementById("plans");
const levelBox = document.getElementById("levelBox");

const plans = [
  {id:"A1",name:"VP A1",amount:4000,profit:200,open:true,level:1},
  {id:"D2",name:"VP D2",amount:15800,profit:500,open:true,level:2},
  {id:"M3",name:"VP M3",amount:50000,profit:2000,open:true,level:3},
  {id:"B4",name:"VP B4",amount:90000,profit:4000,open:false,level:4},
  {id:"C5",name:"VP C5",amount:170000,profit:9000,open:false,level:5},
  {id:"N6",name:"VP N6",amount:230000,profit:13000,open:false,level:6},
  {id:"Y7",name:"VP Y7",amount:450000,profit:20000,open:false,level:7},
  {id:"G8",name:"VP G8",amount:900000,profit:50000,open:false,level:8},
  {id:"F9",name:"VP F9",amount:11000000,profit:100000,open:false,level:9}
];

onAuthStateChanged(auth, async(user)=>{
  if(!user){
    alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href="login.html";
    return;
  }

  const userRef = doc(db,"users",user.uid);
  const userSnap = await getDoc(userRef);
  if(!userSnap.exists()){
    alert("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©");
    window.location.href="login.html";
    return;
  }

  let userData = userSnap.data();
  levelBox.textContent = `â­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: VIP ${userData.level || 0}`;

  for(const plan of plans){
    try{
      const docRef = doc(db,"plans",plan.id);
      const snap = await getDoc(docRef);
      if(snap.exists()){
        plan.open = snap.data().open;
      }
    }catch(e){
      console.log("Ø®Ø·Ø£ ÙÙŠ Firebase",plan.id,e);
    }

    const card = document.createElement("div");
    card.className="card";
    if(!plan.open) card.classList.add("locked");

    card.innerHTML = `
      <div>
        <h3>${plan.name}</h3>
        <p>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${plan.amount} Ø¯Ø¬</p>
        <p>ğŸ“ˆ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${plan.profit} Ø¯Ø¬</p>
        <p>â³ Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±: Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</p>
      </div>
      <button ${!plan.open?"disabled":""}>Ø§Ø³ØªØ«Ù…Ø§Ø±</button>
    `;

    const btn = card.querySelector("button");
    btn.onclick = async()=>{
      userData = (await getDoc(userRef)).data();

      if(userData.balance >= plan.amount){
        // Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº + ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆÙ‰
        await updateDoc(userRef,{
          balance: userData.balance - plan.amount,
          level: plan.level
        });
        levelBox.textContent = `â­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: VIP ${plan.level}`;
        alert("ğŸŠ ØªÙ… Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!");
      }else{
        alert("âŒ Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ!");
        setTimeout(() => { window.location.href = "deposit.html"; }, 100);
      }
    };

    plansContainer.appendChild(card);
  }
});
</script>

</body>
</html>