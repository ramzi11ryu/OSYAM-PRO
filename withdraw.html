
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Osyam VP - Ø³Ø­Ø¨ Ø§Ù„Ø±ØµÙŠØ¯</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {box-sizing:border-box;}
body{
  margin:0;
  font-family:'Arial', sans-serif;
  background: linear-gradient(135deg,#0f0f0f,#1a1a1a);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  color:#fff;
}

.container{
  width:380px;
  padding:25px;
  border-radius:20px;
  background:rgba(30,30,30,0.95);
  box-shadow: 0 0 20px #00ff0033, inset 0 0 10px #00ff0033;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{
  font-size:24px;
  color:#00ff00;
  text-shadow:0 0 8px #00ff00;
  margin-bottom:20px;
}

.card{
  width:100%;
  background:#1c1c1c;
  border-radius:15px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 0 10px #00ff0033;
}

.balance{
  font-size:18px;
  font-weight:bold;
  margin-bottom:10px;
  text-align:center;
  color:#00ff00;
}

.input-group{
  display:flex;
  align-items:center;
  margin-bottom:12px;
  background:#111;
  border-radius:12px;
  padding:8px 12px;
}

.input-group i{
  margin-left:10px;
  color:#00ff00;
}

.input-group input{
  flex:1;
  background:transparent;
  border:none;
  outline:none;
  color:#00ff00;
  font-size:16px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:15px;
  background:linear-gradient(145deg,#111,#222);
  color:#00ff00;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
  transition:0.3s;
  box-shadow:0 0 10px #00ff0033,0 0 20px #00ff0055 inset;
}
button:hover{
  box-shadow:0 0 15px #00ff0055,0 0 30px #00ff0077 inset;
}

button:disabled{
  opacity:.4;
  cursor:not-allowed;
  box-shadow:none;
}

.status{
  margin-top:12px;
  min-height:22px;
  text-align:center;
  font-weight:bold;
  color:#ff5555;
}

.history{
  max-height:180px;
  overflow:auto;
  margin-top:15px;
  background:#111;
  border-radius:12px;
  padding:10px;
  font-size:14px;
  color:#00ff00;
}
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ’ Osyam VP - Ø³Ø­Ø¨ Ø§Ù„Ø±ØµÙŠØ¯</h1>

  <div class="card balance">Ø§Ù„Ø±ØµÙŠØ¯: <span id="balanceBox">0</span> Ø¯Ø¬</div>

  <div class="card">
    <div class="input-group">
      <i class="fas fa-coins"></i>
      <input type="number" id="amount" placeholder="ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº (1000 Ø¯Ø¬ ÙØ£ÙƒØ«Ø±)">
    </div>
    <div class="input-group">
      <i class="fas fa-university"></i>
      <input type="text" id="account" placeholder="ğŸ¦ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨">
    </div>
    <div class="input-group">
      <i class="fas fa-key"></i>
      <input type="password" id="pin" placeholder="ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    </div>
    <button id="withdraw">Ø³Ø­Ø¨ Ø§Ù„Ø¢Ù†</button>
    <div class="status" id="status">Ø¬Ø§Ù‡Ø²</div>
  </div>

  <div class="card history" id="history">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, collection, addDoc, query, where, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase Ø§Ù„Ø¬Ø¯ÙŠØ¯
const firebaseConfig = {
  apiKey: "AIzaSyBiQ4dHe4sbKDIrsyF8WdpjV3sY4qAxU4E",
  authDomain: "osim-d1821.firebaseapp.com",
  projectId: "osim-d1821",
  storageBucket: "osim-d1821.firebasestorage.app",
  messagingSenderId: "464951343183",
  appId: "1:464951343183:web:21c7615a90e4f38385923a",
  measurementId: "G-KSVDWLYNV6"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let uid=null, balance=0, totalDeposit=0;

const balanceBox=document.getElementById("balanceBox");
const statusBox=document.getElementById("status");
const historyBox=document.getElementById("history");
const withdrawBtn=document.getElementById("withdraw");

const amountInput=document.getElementById("amount");
const accountInput=document.getElementById("account");
const pinInput=document.getElementById("pin");

onAuthStateChanged(auth, async user=>{
  if(!user){ window.location.href="login.html"; return; }
  uid=user.uid;
  await loadUser();
  loadHistory();
  checkWithdrawAvailability();
});

async function loadUser(){
  const ref=doc(db,"users",uid);
  const snap=await getDoc(ref);
  if(snap.exists()){
    balance = snap.data().balance || 0;
    totalDeposit = snap.data().totalDeposit || 0;
    if(snap.data().account){
      accountInput.value = snap.data().account;
      accountInput.disabled = true;
    }
  }
  balanceBox.textContent = balance;
}

function checkWithdrawAvailability(){
  if(totalDeposit <=0){
    withdrawBtn.disabled=true;
    statusBox.textContent="ğŸ”’ Ø§Ù„Ø³Ø­Ø¨ Ù…ØªØ§Ø­ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹";
    return;
  }
  withdrawBtn.disabled=false;
  statusBox.textContent="Ø¬Ø§Ù‡Ø²";
}


  withdrawBtn.onclick=async()=>{

  if(withdrawBtn.disabled) return;

  // âœ… Ø´Ø±Ø· Ø§Ù„ÙˆÙ‚Øª
  const now = new Date();
  const hour = now.getHours();

  if(hour < 9 || hour >= 17){
    statusBox.textContent="â›” Ø§Ù„Ø³Ø­Ø¨ Ù…ØªØ§Ø­ ÙÙ‚Ø· Ù…Ù† 09:00 Ø¥Ù„Ù‰ 17:00";
    return;
  }

  const amount=Number(amountInput.value);
  const account=accountInput.value.trim();
  const pin=pinInput.value.trim();

  if(!amount||!account||!pin){
    statusBox.textContent="âŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø§Ù‚ØµØ©";
    return;
  }

  if(amount<1000){
    statusBox.textContent="âŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 1000 Ø¯Ø¬";
    return;
  }

  if(amount>balance){
    statusBox.textContent="ğŸ’¸ Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ";
    return;
  }

  const userRef = doc(db,"users",uid);
  const snap = await getDoc(userRef);

  if(!snap.data().account){
    await updateDoc(userRef,{account});
    accountInput.disabled = true;
  }

  await addDoc(collection(db,"withdraws"),{
    uid, amount, account, pin,
    status:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©",
    createdAt:serverTimestamp()
  });

  balance-=amount;
  await updateDoc(doc(db,"users",uid),{balance});
  balanceBox.textContent = balance;

  statusBox.textContent="âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨";

  amountInput.value="";
  pinInput.value="";
};

  const amount=Number(amountInput.value);
  const account=accountInput.value.trim();
  const pin=pinInput.value.trim();

  if(!amount||!account||!pin){ statusBox.textContent="âŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø§Ù‚ØµØ©"; return; }
  if(amount<1000){ statusBox.textContent="âŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ 1000 Ø¯Ø¬"; return; }
  if(amount>balance){ statusBox.textContent="ğŸ’¸ Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ"; return; }

  const userRef = doc(db,"users",uid);
  const snap = await getDoc(userRef);
  if(!snap.data().account){
    await updateDoc(userRef,{account});
    accountInput.disabled = true;
  }

  await addDoc(collection(db,"withdraws"),{
    uid, amount, account, pin,
    status:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©",
    createdAt:serverTimestamp()
  });

  balance-=amount;
  await updateDoc(doc(db,"users",uid),{balance});
  balanceBox.textContent = balance;
  statusBox.textContent="âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨";

  amountInput.value="";
  pinInput.value="";
};

function loadHistory(){
  const q=query(collection(db,"withdraws"), where("uid","==",uid));
  onSnapshot(q,snap=>{
    let html="";
    snap.forEach(d=>{
      const x=d.data();
      if(x.createdAt){
        html+=`ğŸ’° ${x.amount} Ø¯Ø¬ â€“ ${x.status}<br>ğŸ•’ ${x.createdAt.toDate().toLocaleString()}<hr>`;
      }
    });
    historyBox.innerHTML = html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª";
  });
}
</script>

</body>
</html>
