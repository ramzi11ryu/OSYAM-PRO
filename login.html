<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Osyam Pro - Ù…Ù†ØµØ© VP</title>
<style>
body{
  margin:0;
  font-family: 'Arial', sans-serif;
  background:#0b0c10;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container{
  width:400px;
  background:linear-gradient(145deg,#1c1c1c,#111);
  border-radius:25px;
  padding:30px;
  box-shadow:0 0 25px #00ff0055, inset 0 0 15px #00ff0055;
}
h2{
  text-align:center;
  color:#00ff00;
  margin-bottom:20px;
  font-size:26px;
  text-shadow:0 0 8px #00ff00;
}
input{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:12px;
  border:none;
  background:#111;
  color:#00ff00;
  font-size:16px;
}
button{
  width:100%;
  padding:15px;
  margin-top:10px;
  border:none;
  border-radius:15px;
  background:linear-gradient(145deg,#111,#222);
  color:#00ff00;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}
button:disabled{ opacity:.5; cursor:not-allowed; }
.status{ margin-top:12px; text-align:center; min-height:24px; color:#ff5555; }
.link{ margin-top:15px; text-align:center; font-size:14px; color:#aaa; cursor:pointer; }
</style>
</head>
<body>

<div class="container">
  <h2 id="formTitle">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h2>

  <input type="text" id="phone" placeholder="ğŸ“± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <input type="password" id="password" placeholder="ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <input type="text" id="invite" placeholder="ğŸ Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" style="display:none;">

  <button id="submitBtn">Ø¯Ø®ÙˆÙ„</button>
  <div class="status" id="status"></div>
  <div class="link" id="toggleForm">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBiQ4dHe4sbKDIrsyF8WdpjV3sY4qAxU4E",
  authDomain: "osim-d1821.firebaseapp.com",
  projectId: "osim-d1821",
  storageBucket: "osim-d1821.firebasestorage.app",
  messagingSenderId: "464951343183",
  appId: "1:464951343183:web:21c7615a90e4f38385923a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const formTitle = document.getElementById("formTitle");
const phoneInput = document.getElementById("phone");
const passwordInput = document.getElementById("password");
const inviteInput = document.getElementById("invite");
const submitBtn = document.getElementById("submitBtn");
const status = document.getElementById("status");
const toggleForm = document.getElementById("toggleForm");

let isSignup=false;

// ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙ‡Ù…ÙŠ
function phoneToEmail(phone){
  return phone+"@osyam.fake";
}

// ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
toggleForm.onclick = ()=>{
  isSignup = !isSignup;
  formTitle.textContent = isSignup?"ğŸ” Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨":"ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„";
  submitBtn.textContent = isSignup?"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨":"Ø¯Ø®ÙˆÙ„";
  inviteInput.style.display = isSignup?"block":"none";
  status.textContent="";
  phoneInput.value=""; passwordInput.value=""; inviteInput.value="";
  toggleForm.textContent = isSignup?"Ù„Ø¯ÙŠ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„":"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯";
};

// Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„
submitBtn.onclick = async ()=>{
  const phone = phoneInput.value.trim();
  const password = passwordInput.value.trim();
  const invite = inviteInput.value.trim();

  if(!phone || !password){ status.textContent="âŒ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"; return; }

  const email = phoneToEmail(phone);

  try{
    if(isSignup){
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firebase Auth
      const userCredential = await createUserWithEmailAndPassword(auth,email,password);
      const user = userCredential.user;

      // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙÙŠ Firestore
      await setDoc(doc(db,"users",user.uid),{
        phone: phone,
        invite: invite || "",
        balance: 0,
        level: 0,
        totalDeposit: 0,
        createdAt: new Date()
      });

      alert("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
      phoneInput.value=""; passwordInput.value=""; inviteInput.value="";
    }else{
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      const userCredential = await signInWithEmailAndPassword(auth,email,password);
      const user = userCredential.user;

      // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡
      const snap = await getDoc(doc(db,"users",user.uid));
      if(snap.exists()){
        alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
        window.location.href="index.html";
      }
    }
  }catch(error){
    status.textContent="âŒ "+error.message;
  }
};
</script>

</body>
</html>