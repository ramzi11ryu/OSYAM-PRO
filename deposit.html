<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>VP Platform - Deposit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{
  margin:0;
  background:#0f1115;
  font-family:'Cairo',sans-serif;
  color:#fff;
}

/* ===== Header ===== */
.header{
  background:#141822;
  padding:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #222;
}
.logo{
  font-weight:bold;
  font-size:20px;
  color:#00e0ff;
}
.badge{
  background:#1e2633;
  padding:8px 15px;
  border-radius:20px;
  font-size:13px;
  border:1px solid #2b3445;
}

/* ===== Container ===== */
.container{
  max-width:450px;
  margin:25px auto;
  padding:15px;
}

/* ===== Card ===== */
.card{
  background:#161b25;
  border:1px solid #242c3a;
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 8px 25px rgba(0,0,0,.6);
}

.card-title{
  font-weight:bold;
  margin-bottom:15px;
  color:#00e0ff;
}

/* ===== Copy Box ===== */
.copy-box{
  background:#1f2633;
  border:1px solid #2d3748;
  padding:12px;
  border-radius:12px;
  text-align:center;
  color:#00e0ff;
  cursor:pointer;
  transition:.3s;
}
.copy-box:hover{
  border-color:#00e0ff;
}

/* ===== Inputs ===== */
.input-group{
  display:flex;
  align-items:center;
  background:#1f2633;
  border:1px solid #2d3748;
  border-radius:12px;
  padding:0 10px;
  margin-bottom:12px;
}

.input-group i{
  color:#00e0ff;
  margin-left:8px;
}

.input-group input{
  flex:1;
  background:transparent;
  border:none;
  padding:12px 5px;
  color:#fff;
  font-size:14px;
}

/* ===== Button ===== */
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:25px;
  background:linear-gradient(45deg,#00e0ff,#0088ff);
  color:#000;
  font-weight:bold;
  cursor:pointer;
  transition:.3s;
}
button:hover{
  box-shadow:0 0 15px #00e0ff;
}
button:disabled{opacity:.6}

/* ===== History ===== */
.history{
  font-size:13px;
  line-height:1.7;
}
.history-item{
  background:#1f2633;
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
  border:1px solid #2d3748;
}
hr{
  border:0;
  border-top:1px solid #2d3748;
}
</style>
</head>
<body>

<div class="header">
  <div class="logo"><i class="fa-solid fa-gem"></i> VP PLATFORM</div>
  <div class="badge">Deposit System</div>
</div>

<div class="container">

  <!-- Deposit Card -->
  <div class="card">
    <div class="card-title">ğŸ’³ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</div>
<div id="copyBox" class="copy-box" onclick="copyCCP()">
  ğŸ“‹ Ù†Ø³Ø® Ø±Ù‚Ù… â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢5427
</div>

    <br>

    <form id="depositForm">

      <div class="input-group">
        <i class="fa-regular fa-user"></i>
        <input type="text" id="name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
      </div>

      <div class="input-group">
        <i class="fa-regular fa-image"></i>
        <input type="file" id="photo" accept="image/*" required>
      </div>

      <div class="input-group">
        <i class="fa-solid fa-money-bill"></i>
        <input type="number" id="amount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹" required>
      </div>

      <div class="input-group">
        <i class="fa-solid fa-phone"></i>
        <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
      </div>

      <div class="input-group">
        <i class="fa-solid fa-building-columns"></i>
        <input type="text" id="userCCP" placeholder="Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ CCP" required>
      </div>

      <button type="submit" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button>
    </form>
  </div>

  <!-- History -->
  <div class="card">
    <div class="card-title">ğŸ“„ Ø³Ø¬Ù„ Ø¥ÙŠØ¯Ø§Ø¹Ø§ØªÙƒ</div>
    <div class="history" id="history">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª</div>
  </div>

</div>

<!-- Firebase + Telegram (Ù†ÙØ³ Ø®Ø¯Ù…ØªÙƒ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore, collection, addDoc,
  query, where, onSnapshot, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBiQ4dHe4sbKDIrsyF8WdpjV3sY4qAxU4E",
  authDomain: "osim-d1821.firebaseapp.com",
  projectId: "osim-d1821",
  storageBucket: "osim-d1821.firebasestorage.app",
  messagingSenderId: "464951343183",
  appId: "1:464951343183:web:21c7615a90e4f38385923a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let uid=null;
const historyBox=document.getElementById("history");

signInAnonymously(auth);

onAuthStateChanged(auth,u=>{
  if(u){ uid=u.uid; loadHistory(); }
});

const form=document.getElementById("depositForm");
const btn=document.getElementById("sendBtn");

form.onsubmit = async (e)=>{
  e.preventDefault();
  btn.disabled=true;
  btn.innerText="â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  const name=nameInput.value;
  const photo=photoInput.files[0];
  const amount=amountInput.value;
  const phone=phoneInput.value;
  const userCCP=userCCPInput.value;

  try{
    const tg=new FormData();
    tg.append("chat_id","5722416028");
    tg.append("caption",
`ğŸ‘¤ ${name}
ğŸ’° ${amount} Ø¯Ø¬
ğŸ“± ${phone}
ğŸ¦ ${userCCP}`);
    tg.append("photo",photo);

    await fetch("https://api.telegram.org/bot8561874849:AAEIpNUvli0QHp-c_GfnYf3NwB5k-f7nMiI/sendPhoto",
    {method:"POST",body:tg});

    await addDoc(collection(db,"deposits"),{
      uid,name,amount:Number(amount),
      phone,userCCP,
      status:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
      createdAt:serverTimestamp()
    });

    form.reset();
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­");

  }catch(err){
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£");
  }

  btn.disabled=false;
  btn.innerText="Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹";
};

function loadHistory(){
  const q=query(collection(db,"deposits"),where("uid","==",uid));
  onSnapshot(q,snap=>{
    let html="";
    snap.forEach(d=>{
      const x=d.data();
      if(x.createdAt){
        html+=`
        <div class="history-item">
          ğŸ’° ${x.amount} Ø¯Ø¬<br>
          ğŸ“± ${x.phone}<br>
          ğŸ¦ ${x.userCCP}<br>
          â³ ${x.status}<br>
          ğŸ“… ${x.createdAt.toDate().toLocaleString("ar-DZ")}
        </div>`;
      }
    });
    historyBox.innerHTML = html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª";
  });
}

const nameInput=document.getElementById("name");
const photoInput=document.getElementById("photo");
const amountInput=document.getElementById("amount");
const phoneInput=document.getElementById("phone");
const userCCPInput=document.getElementById("userCCP");
</script>
<script>
function copyCCP(){
  const box=document.getElementById("copyBox");
  navigator.clipboard.writeText("00799999002084015427");
  box.innerText="âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙƒØ§Ù…Ù„";
  setTimeout(()=>{
    box.innerText="ğŸ“‹ Ù†Ø³Ø® Ø±Ù‚Ù… â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢5427";
  },1500);
}
</script>
</body>
</html>
